---
applyTo: "**/*.py"
---

# Python Script Standards (must be followed exactly)

## Coding Style

- Refer to `pyproject.toml` for ruff configuration and follow those formatting & linting rules.
- All imports should be placed at the top of the file, grouped in the following order with a blank line between each group:
  1. Standard library imports
  2. Third-party imports
  3. Local application/library-specific imports
  - The only exceptions would be to avoid circular dependencies, or other extenuating circumstances.
- Do not add return type hints to function definitions, allowing the type checker to infer them.
- Do add type hints for function parameters.
- Do add type hints for local arrays that will be returned from functions.

## Additional Requirements

- Executable Python scripts must have a shebang line: `#!/usr/bin/env python` and be marked as executable.
- When running pytest, prefix the command with `PYTHONPATH=. ` to ensure the root directory is included in the module search path.
- Each `logic.py` file must have 100% test coverage.
  - All tests for a given action should be in a single test file in `./tests/actions/<package>`
  - Check with `PYTHONPATH=. pytest tests/<action_path>/test_logic.py --cov=<action_dotpath>--cov-report=term-missing`
  - To aid this and keep git diffs manageable:
    - Keep functions small and focused on a single task
    - Each `logic.py` file should have a single entrypoint (`def handle(...)`) which takes a Request object and returns a Response object (generated by protobuf)
    - Break out helper functions into separate `util.py` files within the same directory
    - When this become too complex, look to break the logic down into multiple actions in the same domain (or add a subdomain, if appropriate)
- Each action must have a corresponding `contracts.proto` file defining the Request and Response messages.
- Each action package (containing a logic file) should contain not more than 300 lines of code.

## Notes

- Any directory within `./mhs` that contains a `logic.py` file is considered an "action" (the filename must be an exact match).
